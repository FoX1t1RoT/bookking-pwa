<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BookKing - Reading Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json?v=4.9.4&t=1734725000">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BookKing">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="BookKing">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-config" content="none">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="assets/icons/icon-192.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/icons/icon-192.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-192.svg">
    <link rel="apple-touch-icon" sizes="167x167" href="assets/icons/icon-192.svg">
    
    <!-- Splash Screen for iOS -->
    <link rel="apple-touch-startup-image" href="assets/icons/icon-512.svg">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/css/main-new.css?v=1.0.13&t=1734747000">
    <link rel="stylesheet" href="assets/css/components.css?v=4.9.26&t=1734725000">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="shortcut icon" href="favicon.ico">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="assets/js/offline-enforcer.js?v=1.1.0&t=1734748000" as="script">
    <link rel="preload" href="assets/js/storage.js?v=4.6.3&t=1734725000" as="script">
    <link rel="preload" href="assets/js/app.js?v=4.4.11&t=1734747000" as="script">
</head>
<body>
    <div class="app-container">
        <!-- Header Component -->
        <header class="app-header">
            <div class="header-left">
                <!-- Back button removed -->
            </div>
            <div class="header-center">
                <h1 class="header-title">Read</h1>
            </div>
            <div class="header-right">
                <button class="add-button" id="addBookBtn">
                    <span class="plus-icon">+</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Content will be dynamically loaded here -->
        </main>

        <!-- Tab Navigation Component -->
        <nav class="tab-navigation">
            <button class="tab-item active" data-tab="read">
                <span class="tab-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="11" y="2" width="2" height="3" rx="1" fill="currentColor"/>
                        <circle cx="12" cy="13" r="8" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M12 13L8.5 8.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                        <rect x="11.5" y="6" width="1" height="2" rx="0.5" fill="currentColor"/>
                        <circle cx="12" cy="13" r="1.5" fill="currentColor"/>
                    </svg>
                </span>
                <span class="tab-label">Read</span>
            </button>
            <button class="tab-item" data-tab="track">
                <span class="tab-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    </svg>
                </span>
                <span class="tab-label">Track</span>
            </button>
            <button class="tab-item" data-tab="plan">
                <span class="tab-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="6" width="18" height="15" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M16 4V8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M8 4V8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M3 10H21" stroke="currentColor" stroke-width="2"/>
                        <circle cx="8" cy="14" r="1" fill="currentColor"/>
                        <circle cx="12" cy="14" r="1" fill="currentColor"/>
                        <circle cx="16" cy="14" r="1" fill="currentColor"/>
                        <circle cx="8" cy="17" r="1" fill="currentColor"/>
                        <circle cx="12" cy="17" r="1" fill="currentColor"/>
                    </svg>
                </span>
                <span class="tab-label">Plan</span>
            </button>
            <button class="tab-item" data-tab="settings">
                <span class="tab-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è iPhone —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞ -->
                        <g fill="currentColor">
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥ -->
                            <circle cx="12" cy="12" r="7"/>
                            
                            <!-- 8 –∑—É–±—å–µ–≤ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ -->
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(45 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(90 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(135 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(180 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(225 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(270 12 12)"/>
                            <rect x="11.3" y="3.5" width="1.4" height="2" rx="0.7" transform="rotate(315 12 12)"/>
                        </g>
                        
                        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ -->
                        <circle cx="12" cy="12" r="2.5" fill="var(--bg-secondary, #ffffff)"/>
                    </svg>
                </span>
                <span class="tab-label">Settings</span>
            </button>
        </nav>
    </div>

    <!-- Archive Modal Component -->
    <div class="modal-overlay" id="archiveModal">
        <div class="modal-content">
            <header class="modal-header">
                <h2 class="modal-title">Archive</h2>
                <button class="modal-close" id="closeArchive">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </header>
            <div class="archive-content">
                <div class="empty-state">
                    <p class="empty-message">No finished books yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- iOS PWA Installation Prompt -->
    <div id="iosInstallPrompt" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: #000; color: #fff; padding: 10px; text-align: center; z-index: 10000;">
        <p>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ BookKing –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã</p>
        <button onclick="hideIOSPrompt()" style="background: #007AFF; color: #fff; border: none; padding: 8px 16px; border-radius: 8px; margin: 5px;">–ü–æ–Ω—è—Ç–Ω–æ</button>
    </div>

    <!-- Scripts -->
    <script src="assets/js/offline-enforcer.js?v=1.1.0&t=1734748000"></script>
    <script src="assets/js/storage.js?v=4.6.3&t=1734725000"></script>
    <script src="assets/js/components.js?v=4.9.12&t=1734725000"></script>
    <script src="assets/js/plan-component.js?v=4.4.2&t=1734725000"></script>
    <script src="assets/js/settings-component.js?v=4.4.1&t=1734725000"></script>
    <script src="assets/js/app.js?v=4.4.11&t=1734747000"></script>
    
    <script>
        // iOS PWA Detection and Installation
        function detectIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }
        
        function isStandalone() {
            return window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
        }
        
        function showIOSInstallPrompt() {
            if (detectIOS() && !isStandalone()) {
                const prompt = document.getElementById('iosInstallPrompt');
                prompt.style.display = 'block';
                console.log('BookKing: iOS install prompt shown');
            }
        }
        
        function hideIOSPrompt() {
            const prompt = document.getElementById('iosInstallPrompt');
            prompt.style.display = 'none';
        }
        
        // Show iOS install prompt after 3 seconds
        setTimeout(showIOSInstallPrompt, 3000);
        
        // AGGRESSIVE OFFLINE MODE - BLOCK ALL NETWORK IMMEDIATELY
        console.log('BookKing: AGGRESSIVE OFFLINE MODE - BLOCKING ALL NETWORK');
        
        // IMMEDIATELY block all network requests before anything else loads
        (function() {
            'use strict';
            
            // Block fetch immediately
            window.fetch = function(url, options) {
                console.log('BookKing: AGGRESSIVE BLOCK - fetch to:', url);
                return Promise.reject(new Error('AGGRESSIVE OFFLINE MODE - Network blocked'));
            };
            
            // Block XMLHttpRequest immediately
            XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
                console.log('BookKing: AGGRESSIVE BLOCK - XHR to:', url);
                throw new Error('AGGRESSIVE OFFLINE MODE - XHR blocked');
            };
            
            // Block WebSocket
            if (window.WebSocket) {
                window.WebSocket = function(url, protocols) {
                    console.log('BookKing: AGGRESSIVE BLOCK - WebSocket to:', url);
                    throw new Error('AGGRESSIVE OFFLINE MODE - WebSocket blocked');
                };
            }
            
            // Block EventSource
            if (window.EventSource) {
                window.EventSource = function(url) {
                    console.log('BookKing: AGGRESSIVE BLOCK - EventSource to:', url);
                    throw new Error('AGGRESSIVE OFFLINE MODE - EventSource blocked');
                };
            }
            
            // Force navigator.onLine to false
            try {
                Object.defineProperty(navigator, 'onLine', {
                    get: function() { return false; },
                    configurable: true
                });
            } catch (e) {
                console.log('BookKing: navigator.onLine already set');
            }
            
            // Block window.open
            window.open = function(url, name, features) {
                console.log('BookKing: AGGRESSIVE BLOCK - window.open to:', url);
                return null;
            };
            
            // Block location changes
            try {
                const originalHref = Object.getOwnPropertyDescriptor(Location.prototype, 'href');
                if (originalHref && originalHref.configurable) {
                    Object.defineProperty(location, 'href', {
                        get: function() { return originalHref.get.call(this); },
                        set: function(value) {
                            if (value && !value.startsWith('#') && !value.startsWith('/')) {
                                console.log('BookKing: AGGRESSIVE BLOCK - location change to:', value);
                                return;
                            }
                            originalHref.set.call(this, value);
                        },
                        configurable: true
                    });
                }
            } catch (e) {
                console.log('BookKing: location.href already set');
            }
            
            console.log('BookKing: AGGRESSIVE OFFLINE MODE - All network blocked immediately');
        })();
        
        // Register Service Worker for completely offline operation
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js?v=aggressive-offline-v1.0.7&t=1734750000')
                    .then((registration) => {
                        console.log('SW registered for AGGRESSIVE offline use: ', registration);
                        
                        // Force completely offline mode
                        if (registration.active) {
                            registration.active.postMessage({ action: 'FORCE_AGGRESSIVE_OFFLINE' });
                            console.log('Service Worker is active and AGGRESSIVE offline ready');
                        }
                        
                        // Listen for updates but stay offline
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New service worker installed, staying AGGRESSIVE offline');
                                    newWorker.postMessage({ action: 'SKIP_WAITING' });
                                    window.location.reload();
                                }
                            });
                        });
                        
                        // Handle service worker updates
                        navigator.serviceWorker.addEventListener('controllerchange', () => {
                            console.log('Service Worker controller changed - app is AGGRESSIVE offline');
                            if (navigator.serviceWorker.controller) {
                                navigator.serviceWorker.controller.postMessage({ action: 'FORCE_AGGRESSIVE_OFFLINE' });
                            }
                        });
                        
                        // Check offline status
                        if (navigator.serviceWorker.controller) {
                            navigator.serviceWorker.controller.postMessage({ action: 'CHECK_AGGRESSIVE_OFFLINE_STATUS' });
                        }
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        } else {
            console.log('Service Worker not supported - AGGRESSIVE offline functionality disabled');
        }
        
        // Listen for online/offline events but stay completely offline
        window.addEventListener('online', () => {
            console.log('BookKing: Network available but staying AGGRESSIVE offline');
        });
        
        window.addEventListener('offline', () => {
            console.log('BookKing: Network unavailable - continuing AGGRESSIVE offline');
        });
        
        // Prevent any network requests from the app
        window.addEventListener('beforeunload', () => {
            console.log('BookKing: App unloading - AGGRESSIVE offline mode maintained');
        });
        
        // Block any remaining network attempts
        window.addEventListener('error', function(event) {
            if (event.target && event.target.src) {
                console.log('BookKing: AGGRESSIVE BLOCK - resource loading:', event.target.src);
                event.preventDefault();
            }
        });
        
        // Periodic re-blocking to ensure nothing gets through
        setInterval(() => {
            // Re-block fetch
            window.fetch = function(url, options) {
                console.log('BookKing: PERIODIC BLOCK - fetch to:', url);
                return Promise.reject(new Error('AGGRESSIVE OFFLINE MODE - Network blocked'));
            };
            
            // Re-block XHR
            XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
                console.log('BookKing: PERIODIC BLOCK - XHR to:', url);
                throw new Error('AGGRESSIVE OFFLINE MODE - XHR blocked');
            };
            
            // Re-block WebSocket
            if (window.WebSocket) {
                window.WebSocket = function(url, protocols) {
                    console.log('BookKing: PERIODIC BLOCK - WebSocket to:', url);
                    throw new Error('AGGRESSIVE OFFLINE MODE - WebSocket blocked');
                };
            }
            
            // Re-block EventSource
            if (window.EventSource) {
                window.EventSource = function(url) {
                    console.log('BookKing: PERIODIC BLOCK - EventSource to:', url);
                    throw new Error('AGGRESSIVE OFFLINE MODE - EventSource blocked');
                };
            }
        }, 500); // Check every 500ms
        
        console.log('BookKing: AGGRESSIVE OFFLINE MODE - All network access completely blocked with periodic enforcement');
    </script>
</body>
</html> 